generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  GESTOR
  OPERADOR
}

enum CheckInStatus {
  CHECKED_IN
  CHECKED_OUT
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(OPERADOR)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  
  creator   User?    @relation("UserCreatedBy", fields: [createdBy], references: [id])
  createdUsers User[] @relation("UserCreatedBy")
  events    Event[]  @relation("EventCreatedBy")
  
  @@map("users")
}

model Event {
  id          String   @id @default(cuid())
  name        String
  description String?
  location    String
  startDate   DateTime
  endDate     DateTime
  capacity    Int?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String
  
  creator           User                @relation("EventCreatedBy", fields: [createdBy], references: [id])
  eventParticipants EventParticipant[]
  checkIns          CheckIn[]
  
  @@map("events")
}

model Participant {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String?
  document  String?
  company   String?
  position  String?
  photoUrl  String?
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  eventParticipants EventParticipant[]
  
  @@map("participants")
}

model EventParticipant {
  id            String   @id @default(cuid())
  participantId String
  eventId       String
  qrCode        String   @unique
  status        String   @default("CONFIRMED") // CONFIRMED, CANCELLED, ATTENDED
  registeredAt  DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  participant Participant @relation(fields: [participantId], references: [id], onDelete: Restrict)
  event       Event       @relation(fields: [eventId], references: [id], onDelete: Restrict)
  checkIns    CheckIn[]
  
  @@unique([participantId, eventId])
  @@map("event_participants")
}

model CheckIn {
  id                   String          @id @default(cuid())
  eventParticipantId   String
  eventId              String
  checkInTime          DateTime        @default(now())
  checkOutTime         DateTime?
  status               CheckInStatus   @default(CHECKED_IN)
  scannedBy            String?
  location             String?
  notes                String?
  
  eventParticipant EventParticipant @relation(fields: [eventParticipantId], references: [id], onDelete: Restrict)
  event            Event            @relation(fields: [eventId], references: [id], onDelete: Restrict)
  
  @@map("check_ins")
}
